--- a/net/minecraft/world/level/redstone/NeighborUpdater.java
+++ b/net/minecraft/world/level/redstone/NeighborUpdater.java
@@ -8,60 +8,75 @@
 import net.minecraft.core.BlockPos;
 import net.minecraft.core.Direction;
 import net.minecraft.core.registries.BuiltInRegistries;
+import net.minecraft.server.level.ServerLevel;
 import net.minecraft.world.level.Level;
 import net.minecraft.world.level.LevelAccessor;
 import net.minecraft.world.level.block.Block;
-import net.minecraft.world.level.block.state.BlockState;
+import net.minecraft.world.level.block.state.IBlockData;
+import org.bukkit.craftbukkit.CraftWorld;
+import org.bukkit.craftbukkit.block.CraftBlock;
+import org.bukkit.craftbukkit.block.data.CraftBlockData;
+import org.bukkit.event.block.BlockPhysicsEvent;
+// CraftBukkit end
 
 public interface NeighborUpdater {
+
     Direction[] UPDATE_ORDER = new Direction[]{Direction.WEST, Direction.EAST, Direction.DOWN, Direction.UP, Direction.NORTH, Direction.SOUTH};
 
-    void shapeUpdate(Direction direction, BlockState state, BlockPos pos, BlockPos neighborPos, int flags, int recursionLevel);
+    void shapeUpdate(Direction direction, IBlockData state, BlockPos pos, BlockPos neighborPos, int flags, int recursionLevel);
 
     void neighborChanged(BlockPos pos, Block neighborBlock, BlockPos neighborPos);
 
-    void neighborChanged(BlockState state, BlockPos pos, Block neighborBlock, BlockPos neighborPos, boolean movedByPiston);
+    void neighborChanged(IBlockData state, BlockPos pos, Block neighborBlock, BlockPos neighborPos, boolean movedByPiston);
 
     default void updateNeighborsAtExceptFromFacing(BlockPos pos, Block block, @Nullable Direction facing) {
-        for (Direction direction : UPDATE_ORDER) {
-            if (direction != facing) {
-                this.neighborChanged(pos.relative(direction), block, pos);
+        Direction[] aenumdirection = NeighborUpdater.UPDATE_ORDER;
+        int i = aenumdirection.length;
+
+        for (int j = 0; j < i; ++j) {
+            Direction enumdirection1 = aenumdirection[j];
+
+            if (enumdirection1 != facing) {
+                this.neighborChanged(pos.relative(enumdirection1), block, pos);
             }
         }
+
     }
 
-    static void executeShapeUpdate(
-        LevelAccessor level, Direction direction, BlockState state, BlockPos pos, BlockPos neighborPos, int flags, int recursionLevel
-    ) {
-        BlockState blockState = level.getBlockState(pos);
-        BlockState blockState1 = blockState.updateShape(direction, state, level, pos, neighborPos);
-        Block.updateOrDestroy(blockState, blockState1, level, pos, flags, recursionLevel);
+    static void executeShapeUpdate(LevelAccessor level, Direction direction, IBlockData state, BlockPos pos, BlockPos neighborPos, int flags, int recursionLevel) {
+        IBlockData iblockdata1 = level.getBlockState(pos);
+        IBlockData iblockdata2 = iblockdata1.updateShape(direction, state, level, pos, neighborPos);
+
+        Block.updateOrDestroy(iblockdata1, iblockdata2, level, pos, flags, recursionLevel);
     }
 
-    static void executeUpdate(Level level, BlockState state, BlockPos pos, Block neighborBlock, BlockPos neighborPos, boolean movedByPiston) {
+    static void executeUpdate(Level level, IBlockData state, BlockPos pos, Block neighborBlock, BlockPos neighborPos, boolean movedByPiston) {
         try {
+            // CraftBukkit start
+            CraftWorld cworld = ((ServerLevel) level).getWorld();
+            if (cworld != null) {
+                BlockPhysicsEvent event = new BlockPhysicsEvent(CraftBlock.at(level, pos), CraftBlockData.fromData(state), CraftBlock.at(level, neighborPos));
+                ((ServerLevel) level).getCraftServer().getPluginManager().callEvent(event);
+
+                if (event.isCancelled()) {
+                    return;
+                }
+            }
+            // CraftBukkit end
             state.neighborChanged(level, pos, neighborBlock, neighborPos, movedByPiston);
-        } catch (Throwable var9) {
-            CrashReport crashReport = CrashReport.forThrowable(var9, "Exception while updating neighbours");
-            CrashReportCategory crashReportCategory = crashReport.addCategory("Block being updated");
-            crashReportCategory.setDetail(
-                "Source block type",
-                () -> {
-                    try {
-                        return String.format(
-                            Locale.ROOT,
-                            "ID #%s (%s // %s)",
-                            BuiltInRegistries.BLOCK.getKey(neighborBlock),
-                            neighborBlock.getDescriptionId(),
-                            neighborBlock.getClass().getCanonicalName()
-                        );
-                    } catch (Throwable var2x) {
-                        return "ID #" + BuiltInRegistries.BLOCK.getKey(neighborBlock);
-                    }
+        } catch (Throwable throwable) {
+            CrashReport crashreport = CrashReport.forThrowable(throwable, "Exception while updating neighbours");
+            CrashReportCategory crashreportsystemdetails = crashreport.addCategory("Block being updated");
+
+            crashreportsystemdetails.setDetail("Source block type", () -> {
+                try {
+                    return String.format(Locale.ROOT, "ID #%s (%s // %s)", BuiltInRegistries.BLOCK.getKey(neighborBlock), neighborBlock.getDescriptionId(), neighborBlock.getClass().getCanonicalName());
+                } catch (Throwable throwable1) {
+                    return "ID #" + BuiltInRegistries.BLOCK.getKey(neighborBlock);
                 }
-            );
-            CrashReportCategory.populateBlockDetails(crashReportCategory, level, pos, state);
-            throw new ReportedException(crashReport);
+            });
+            CrashReportCategory.populateBlockDetails(crashreportsystemdetails, level, pos, state);
+            throw new ReportedException(crashreport);
         }
     }
 }
