--- a/net/minecraft/world/level/levelgen/structure/structures/EndCityPieces.java
+++ b/net/minecraft/world/level/levelgen/structure/structures/EndCityPieces.java
@@ -294,8 +283,13 @@
             if (s.startsWith("Chest")) {
                 BlockPos blockpos1 = blockpos.below();
 
-                if (boundingbox.isInside(blockpos1)) {
-                    RandomizableContainer.setBlockEntityLootTable(serverlevelaccessor, randomsource, blockpos1, BuiltInLootTables.END_CITY_TREASURE);
+                if (box.isInside(blockposition1)) {
+                    // CraftBukkit start - ensure block transformation
+                    /*
+                    RandomizableContainer.setBlockEntityLootTable(worldaccess, randomsource, blockposition1, LootTables.END_CITY_TREASURE);
+                    */
+                    setCraftLootTable(level, blockposition1, random, BuiltInLootTables.END_CITY_TREASURE);
+                    // CraftBukkit end
                 }
             } else if (boundingbox.isInside(blockpos) && Level.isInSpawnableBounds(blockpos)) {
                 if (s.startsWith("Sentry")) {
